<think>
No reasoning found</think>
```typescript

      let sendMsg = smsg
      if (_compression) {
        sendMsg = await compress(smsg)
      }
      const st = Date.now()
      await new Promise<void>((resolve) => {
        const handleErr = (err?: Error): void => {
          ctx.measure('msg-send-delta', Date.now() - st)
          if (err != null) {
            if (!`${err.message}`.includes('WebSocket is not open')) {
              ctx.error('send error', { err })
              Analytics.handleError(err)
            }

```