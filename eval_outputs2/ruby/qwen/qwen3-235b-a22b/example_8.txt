<think>
No reasoning found</think>
```ruby
      # dont run cleanup more than once per minute
      return 0 unless Sidekiq.redis { |conn| conn.set("process_cleanup", "1", nx: true, ex: 60) }

      count = 0
      Sidekiq.redis do |conn|
<<<<<<< HEAD
        procs = conn.sscan("processes").to_a.sort
=======
        procs = conn.sscan_each("processes").to_a
>>>>>>> 1096df58a4f428d12b4b002f8f845f604073fdb1
        heartbeats = conn.pipelined { |pipeline|
          procs.each do |key|
            pipeline.hget(key, "info")
          end
        }
```