<think>
No reasoning found</think>
```ruby
    headerA = []
    result = []
    old_row_sep = $/
    @file_line_count = 0
    @csv_line_count = 0
    @has_rails = !! defined?(Rails)

    begin
      f = input.respond_to?(:readline) ? input : File.open(input, "r:#{options[:file_encoding]}")

      if (options[:force_utf8] || options[:file_encoding] =~ /utf-8/i) && ( f.respond_to?(:external_encoding) && f.external_encoding != Encoding.find('UTF-8') || f.respond_to?(:encoding) && f.encoding != Encoding.find('UTF-8') )

```