<think>
No reasoning found</think>
```c
    len = vsnprintf(buf + oldlen, size, fmt, ap);
#endif
    if (len >= 0 && len < size) {
      /* This is the C99-specified criterion for snprintf to have
       * been completely successful. */
<<<<<<< HEAD
=======
      *oldsize = newsize;
>>>>>>> fc089d5df72a9c0eba5b6f11dffc4f9bafae18b5
      return buf;
    } else if (len > 0) {
      /* This is the C99 error condition: the returned length is
       * the required buffer size not counting the NUL. */
      size = len + 1;

```