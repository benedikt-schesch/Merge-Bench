<think>
No reasoning found</think>
```c
    int len, ret;

    bufchain_prefix(&ps->pending_output_data, &data, &len);
    ret = write(ps->to_cmd, data, len);
    if (ret < 0 && errno != EWOULDBLOCK) {
<<<<<<< HEAD
      /* We're inside the Unix frontend here, so we know
       * that the frontend handle is unnecessary. */
      logevent(NULL, strerror(errno));
      fatalbox("%s", strerror(errno));
=======
      plug_closing(ps->plug, strerror(errno), errno, 0);
      return 0;
>>>>>>> fc089d5df72a9c0eba5b6f11dffc4f9bafae18b5
    } else if (ret <= 0) {
      break;
    } else {
      bufchain_consume(&ps->pending_output_data, ret);
      sent += ret;
```