<think>
No reasoning found</think>
```c
   * clean up. (Of course we don't free retbuf, since ownership
   * of that passes to the callback.)
   */
  conn->callback(conn->callback_ctx, conn->retbuf, conn->retlen);
  agent_cancel_query(conn);
  return 0;
}

agent_pending_query *agent_query(void *in,
                                 int inlen,
                                 void **out,
```