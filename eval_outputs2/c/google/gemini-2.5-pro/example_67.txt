<think>
No reasoning found</think>
```c
    int len, ret;

    bufchain_prefix(&ps->pending_output_data, &data, &len);
    ret = write(ps->to_cmd, data, len);
    if (ret < 0 && errno != EWOULDBLOCK) {
      plug_closing(ps->plug, strerror(errno), errno, 0);
      return 0;
    } else if (ret <= 0) {
      break;
    } else {
      bufchain_consume(&ps->pending_output_data, ret);
      sent += ret;

```