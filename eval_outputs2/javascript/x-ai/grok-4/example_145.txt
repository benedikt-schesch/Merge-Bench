<think>
No reasoning found</think>
```javascript

    function extend(e) {
      var curCount = ++counter;
      var cur = posFromMouse(cm, e, true, type == "rect");
      if (!cur) return;
<<<<<<< HEAD
      if (cmp(cur, lastPos) != 0) {
        if (!cm.state.focused) onFocus(cm);
        extendTo(cur);
=======
      if (!posEq(cur, last)) {
        ensureFocus(cm);
        last = cur;
        doSelect(cur);
>>>>>>> e1cfb7fd68e7988f508076063ebc17ddbabe2c92
        var visible = visibleLines(display, doc);
        if (cur.line >= visible.to || cur.line < visible.from)
          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);
      } else {
        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;

```