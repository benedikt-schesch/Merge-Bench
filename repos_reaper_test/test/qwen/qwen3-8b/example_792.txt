<think>
No reasoning found</think>
```java
    } else {
      LOG.error("Unexpected exception from downstream on " + c, e);
    }
    if (c.isOpen()) {
<<<<<<< HEAD
      Channels.close(c);
=======
      Channels.close(c);  // Will trigger channelClosed(), which will cleanup()
    } else {              // else: presumably a connection timeout.
      cleanup(c);         // => need to cleanup() from here directly.
>>>>>>> d543609051366758e579ad168361daadd74cdf7f
    }
  }

  // ------------------------------- //
  // Low-level encoding and decoding //
```