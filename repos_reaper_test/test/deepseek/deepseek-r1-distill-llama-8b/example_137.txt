<think>
No reasoning found</think>
To resolve the merge conflict, the correct code should include the optimization step before compiling the plan. Thus, the right version of the `buildPp` method is the one with the `lp.optimize()` call.

```java
    }

    public static PhysicalPlan buildPp(PigServer pigServer, String query)
    throws Exception {
        LogicalPlan lp = buildLp( pigServer, query );
        lp.optimize(pigServer.getPigContext());
        return ((MRExecutionEngine)pigServer.getPigContext().getExecutionEngine()).compile(lp, 
                pigServer.getPigContext().getProperties());
    }

    public static LogicalPlan parse(String query, PigContext pc) throws FrontendException {
        Map<String, String> fileNameMap = new HashMap<String, String>();
```