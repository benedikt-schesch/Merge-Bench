<think>
No reasoning found</think>
To resolve the merge conflict, we need to ensure that both cases (channel open and closed) are handled properly. The correct approach is to close the channel if it's open, allowing `channelClosed()` to handle cleanup, and call `cleanup(c)` directly if the channel is already closed.

```java
               + " ignore this if we're shutting down", e);
    } else {
      LOG.error("Unexpected exception from downstream on " + c, e);
    }
    if (c.isOpen()) {
      Channels.close(c);
    } else {              // else: presumably a connection timeout.
      cleanup(c);         // => need to cleanup() from here directly.
>>>>>>> d543609051366758e579ad168361daadd74cdf7f
    }
  }

  // ------------------------------- //
  // Low-level encoding and decoding //
```